{% extends 'base.html' %}

{% block content %}

<head>
  <style>
    table {
      border-collapse: separate;
      border-spacing: 0;
      margin: auto;
      width: 100%;
      max-width: 600px;
      border: 1px solid black;
      border-radius: 10px;
      overflow: hidden;
    }

    th, td {
      border: 1px solid black;
      text-align: center;
      padding: 10px;
    }

    th {
      background-color: black;
      color: white;
    }

    td {
      height: 50px;
    }

    .clickable-row {
      cursor: pointer;
    }

    .selected-choice {
      background-color: lightgreen;
    }
  </style>
</head>
<body>
<h2 style="text-align: center;">{{ question }}</h2>
<form id="choiceForm" action="/{{ game_id }}/play" method="post">
  <input id="selectedChoice" type="hidden" name="choice">
  <table>
    <tr>
      <th>Choices</th>
    </tr>
    {% for choice in choices %}
    <tr class="clickable-row" data-choice="{{ choice }}">
      <td>
        {{ choice }}: {{ choices[choice] }}
      </td>
    </tr>
    {% endfor %}
  </table>
</form>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $('.clickable-row').click(function() {
    if (!$(this).hasClass('choice-made')) {
      $('.clickable-row').addClass('choice-made');
      $(this).addClass('selected-choice');
      var choice = $(this).data('choice');
      $('#selectedChoice').val(choice);
      
      // Ajax form submission
      $.ajax({
        url: "/{{ game_id }}/play",
        type: 'post',
        data: $('#choiceForm').serialize(),
        success: function() {
          // Start checking results after successful form submission
          var checkResultsInterval = setInterval(function() {
            $.get('/{{ game_id }}/check_results', function(data) {
              if (data.ready) {
                clearInterval(checkResultsInterval);
                // Redirect to the desired page when ready
                window.location.href = '/{{ game_id }}/' + choice + '/results';
              }
            });
          }, 1000);
        }
      });
    }
  }); 
</script>
</body>

{% endblock %}

